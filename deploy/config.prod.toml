# Production configuration for edgelord
# Deployed to $DEPLOY_PATH/config/config.toml by deploy workflow

exchange = "polymarket"

[exchange_config]
type = "polymarket"
environment = "mainnet"
ws_url = "wss://ws-subscriptions-clob.polymarket.com/ws/market"
api_url = "https://clob.polymarket.com"
chain_id = 137  # Polygon mainnet

[logging]
level = "info"
format = "json"

[strategies]
enabled = ["single_condition", "market_rebalancing"]

[strategies.single_condition]
min_edge = 0.03
min_profit = 0.03

[strategies.market_rebalancing]
min_edge = 0.03
min_profit = 0.03
max_outcomes = 10

[strategies.combinatorial]
enabled = false
max_iterations = 20
tolerance = 0.0001
gap_threshold = 0.02

# Cluster detection for combinatorial arbitrage
[cluster_detection]
enabled = true
debounce_ms = 100
min_gap = 0.02
max_clusters_per_cycle = 50
channel_capacity = 1024

# Relation inference for discovering market dependencies
[inference]
enabled = true
min_confidence = 0.7
ttl_seconds = 3600
batch_size = 30

[wallet]
# Private key loaded from WALLET_PRIVATE_KEY env var

[risk]
max_position_per_market = 500
max_total_exposure = 5000
min_profit_threshold = 0.03
max_slippage = 0.02

[telegram]
enabled = true
notify_opportunities = false
notify_executions = true
notify_risk_rejections = true

[reconnection]
initial_delay_ms = 1000        # 1 second
max_delay_ms = 60000           # 60 seconds max
backoff_multiplier = 2.0       # Double delay each failure
max_consecutive_failures = 10  # Trip circuit breaker after 10 failures
circuit_breaker_cooldown_ms = 300000  # 5 minute cooldown

# === CONNECTION POOL ===
# WebSocket connection management for high-volume subscriptions
[connection_pool]
max_connections = 10           # Maximum WebSocket connections
subscriptions_per_connection = 500  # Tokens per connection before rotation
connection_ttl_secs = 120      # Connection lifetime before refresh
preemptive_reconnect_secs = 30 # Start reconnect before TTL expires
health_check_interval_secs = 30  # Check connection health interval
max_silent_secs = 60           # Max seconds without data before reconnect
channel_capacity = 10000       # Event buffer size

# === MARKET FILTER ===
# Filter markets by volume/liquidity before subscribing
# Applied during market discovery phase
[exchange_config.market_filter]
max_markets = 500              # Maximum markets to track
max_subscriptions = 2000       # Maximum token subscriptions
min_volume_24h = 1000.0        # Minimum 24h volume (USD)
min_liquidity = 500.0          # Minimum liquidity (USD)
max_spread_pct = 0.10          # Maximum bid-ask spread (10%)

# === DEDUPLICATION ===
# Message deduplication for WebSocket events
[exchange_config.dedup]
enabled = true
strategy = "hash"              # Primary: hash | timestamp | content
fallback = "timestamp"         # Fallback if primary fails
cache_ttl_secs = 5             # How long to remember seen messages

# === GOVERNOR ===
# Adaptive subscription management based on latency
[governor]
enabled = true

[governor.latency]
target_p50_ms = 10             # Target median latency
target_p95_ms = 50             # Target 95th percentile
target_p99_ms = 100            # Target 99th percentile
max_p99_ms = 200               # Maximum acceptable p99

[governor.scaling]
check_interval_secs = 10       # How often to check metrics
expand_threshold = 0.70        # Add subs when utilization below this
contract_threshold = 1.20      # Remove subs when utilization above this
expand_step = 50               # Subscriptions to add per cycle
contract_step = 100            # Subscriptions to remove per cycle
cooldown_secs = 60             # Minimum time between scaling actions
